<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gamepad API Test in WebXR</title>
  <style>
    body { background: #000; color: #0f0; font-family: monospace; }
    #log { white-space: pre; }
    button { font-size: 1.5em; padding: 10px; margin: 20px; }
  </style>
</head>
<body>
  <button id="enter-vr">Enter VR</button>
  <div id="log">Waiting for gamepad input...</div>

  <script>
    let xrSession = null;
    const log = document.getElementById('log');

    // Poll gamepads every frame
    function updateGamepadStatus() {
      const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
      let output = '';

      for (let i = 0; i < gamepads.length; i++) {
        const gp = gamepads[i];
        if (gp) {
          output += `Gamepad ${i}: ${gp.id}\n`;
          output += `  Buttons: ${gp.buttons.map(b => b.pressed ? '[P]' : '[ ]').join(' ')}\n`;
          output += `  Axes: ${gp.axes.map(a => a.toFixed(2)).join(', ')}\n\n`;
        }
      }

      log.textContent = output || "No gamepads detected.";
      requestAnimationFrame(updateGamepadStatus);
    }

    updateGamepadStatus();

    // Enter XR when button pressed
    document.getElementById('enter-vr').addEventListener('click', async () => {
      if (navigator.xr) {
        try {
          xrSession = await navigator.xr.requestSession('immersive-vr');
          const refSpace = await xrSession.requestReferenceSpace('local');
          const xrLayer = new XRWebGLLayer(await createFakeGLContext(), xrSession);
          xrSession.updateRenderState({ baseLayer: xrLayer });

          xrSession.requestAnimationFrame(onXRFrame);
        } catch (e) {
          console.error('Failed to enter XR:', e);
          alert('Failed to start XR: ' + e.message);
        }
      } else {
        alert('WebXR not supported.');
      }
    });

    function onXRFrame(time, frame) {
      const session = frame.session;
      session.requestAnimationFrame(onXRFrame);
      // We're just staying inside XR without rendering anything fancy
    }

    // Create a fake WebGL context because XR requires one
    async function createFakeGLContext() {
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl', { xrCompatible: true });
      await gl.makeXRCompatible();
      return gl;
    }
  </script>
</body>
</html>

